<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Profiles</title>
    <style>
    </style>
</head>
<body>
    <h1>User Profiles</h1>
    <select id="profileNames">
        
    </select>

    <label for="nameInput">Name:</label>
    <input type="text" id="nameInput"><br><br>

    <label for="modeSelect">Mode:</label>
    <select id="modeSelect">
        <option value="0">Manual</option>
        <option value="1">Automatic</option>
    </select><br><br>

    <label for="moistureRange">Target Moisture:</label>
    <input type="range" id="moistureRange" min="0" max="100"><span id="moistureValue"></span><br><br>

    <label for="waterTimingInput">Water Timing:</label>
    <input type="text" id="waterTimingInput"><br><br>

    <label for="amountOfWaterInput">Amount of Water:</label>
    <input type="number" id="amountOfWaterInput"><br><br>

    <button id="createProfileBtn">Create Profile</button>
    <button id="deleteProfileBtn">Delete Profile</button>
    <p id="notificationMessage"></p>

    <script>
        
        function updateSelectOptions() {
            fetch('/selectData')
                .then(response => response.json())
                .then(data => {
                    const selectElement = document.getElementById('profileNames');
                    // Clear existing options
                    selectElement.innerHTML = '';

                    data.forEach(profile => {
                        const option = document.createElement('option');
                        option.value = profile.name;
                        option.textContent = profile.name;
                        selectElement.appendChild(option);
                    });
                })
                .catch(error => console.error(error));
}

        const profileNamesSelect = document.getElementById('profileNames');
        const profileDataDiv = document.getElementById('profileData');
        const moistureRange = document.getElementById('moistureRange');
        const moistureValue = document.getElementById('moistureValue');
        const deleteProfileBtn = document.getElementById('deleteProfileBtn');

        profileNamesSelect.addEventListener('change', function() {
            const selectedName = profileNamesSelect.value;

            fetch(`/profileData?name=${selectedName}`)
                .then(response => response.json())
                .then(data => {
                    const profile = data;
                    console.log(profile[0])
                    document.getElementById('nameInput').value = profile[0].name;
                    document.getElementById('modeSelect').value = profile[0].auto.toString();
                    document.getElementById('moistureRange').value = profile[0].target_moisture;
                    document.getElementById('waterTimingInput').value = profile[0].water_timing;
                    document.getElementById('amountOfWaterInput').value = profile[0].amount_of_water;
                    moistureValue.textContent = moistureRange.value;
                })
                .catch(error => console.error(error));
        });
        moistureRange.addEventListener('input', function() {
            moistureValue.textContent = moistureRange.value;
        });

        const createProfileBtn = document.getElementById('createProfileBtn');

        createProfileBtn.addEventListener('click', function() {
            const nameInput = document.getElementById('nameInput').value
            const modeSelect = document.getElementById('modeSelect').value
            const moistureRange = document.getElementById('moistureRange').value
            const waterTimingInput = document.getElementById('waterTimingInput').value
            const amountOfWaterInput = document.getElementById('amountOfWaterInput').value
            const profileData = {
                name: nameInput,
                auto: parseInt(modeSelect),
                target_moisture: parseInt(moistureRange),
                water_timing: waterTimingInput,
                amount_of_water: parseInt(amountOfWaterInput)
            };

            console.log(profileData)

            fetch('/createProfile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(profileData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Profile created successfully:', data);
                const notificationMessage = document.getElementById('notificationMessage')
                if(data.error) {
                    notificationMessage.textContent = data.error
                }
                else {
                    notificationMessage.textContent = 'Profile created successfully';
                }
                // Optionally update the UI or perform other actions upon successful profile creation
            })
            .catch(error => console.error('Error creating profile:', error));

        });
        updateSelectOptions();
        profileNamesSelect.addEventListener('click', function() {
            updateSelectOptions();
        });
        deleteProfileBtn.addEventListener('click', function() {
            const nameInput = document.getElementById('nameInput').value;

            fetch(`/deleteProfile?name=${nameInput}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    notificationMessage.textContent = 'Profile successfully deleted';
                } else {
                    notificationMessage.textContent = 'Profile not found';
                }
            })
            .catch(error => console.error('Error deleting profile:', error));
        });
    </script>
</body>
</html>
